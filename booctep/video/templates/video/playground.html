{% extends "video/base.html" %}

{% load i18n %}
{% load static %}

{% block content %}
    {% load static %}

    <style>

        .teacher {
            float: right !important;
        }

        .bluesky {
            background: #61e076bf !important;
        }

        .message {
            max-width: 300px;
            clear: both;
            text-decoration: none;
            list-style-type: none;
            margin: 5px 5px 0px 5px;
            float: left;
            margin-right: 20px;
            padding: 0px 0px;
            min-width: 160px;
            min-height: 10px;
            max-width: 350px;
            border-radius: 5px;
            line-height: 1.4;
            word-wrap: break-word;
            color: #444444;
            text-align: left;
        }
    </style>
    
<style>


    .mdk-drawer-layout__content .app-messages__container-dark{
        background-color: #4c525e !important;
    }
    
    .blllu{
        color: rgb(11, 111, 241) !important;
    } 
    
    .blllu-dark{
        color: rgb(177, 197, 223) !important;
        margin-right: 8px !important;
    }
    
    
    .card-footer{
        background-color: rgb(255, 255, 255) !important;
        border-bottom: 0.5px solid rgb(211, 228, 236)!important;
    }
    
    
    .bllu{
        color: rgb(57, 137, 241) !important;
    } 
    .bllu-dark{

        color: rgb(177, 200, 230) !important;
    }
    .card-footer-dark{
        background-color: rgb(26, 28, 34) !important;
        border: 1px solid rgb(9, 10, 12) !important;
    }
    
    .btn-light{
        background-color: #3a76d1 !important;
        color: rgb(199, 199, 199) !important;
        
        border: 1px solid  #2d62b3 !important;
        box-shadow: none !important;
    }
    
    
    .btn-light-dark{
        background-color: #323741 !important;
        color: rgb(199, 199, 199) !important;
        
        border: 1px solid  #21242b !important;
        box-shadow: none !important;
    }
    
    
    .brd{
        border: 0 ;
        color: #fff;
    }
    
    .brd-dark{
        border: 0;
        color: rgb(202, 202, 202);
    }
    
    
    .avatar-offline:after,
    .avatar-offline:before,
    .avatar-online:after,
    .avatar-online:before {
        display: none !important;
    }
    
    
    .sidebar-dark{
        background-color: #22252c !important;
        border-left: 1px solid #323741 !important;
    }
    
    
    .sidebar-dark .divee{
        background-color: #22252c !important;
        border-left: 1px solid #1d1f22 !important;
    }
    
    
    .mediabout{
        color: rgb(21, 43, 71) !important;
    }
      
    .mediabout-dark{
       color: rgb(219, 219, 219) !important;
    }
    
    
    .ptt{
        padding-top: 80px !important;
    }
    .btn-primary{
        background-color: rgb(33, 150, 243)!important;
        color: rgb(254, 254, 255);
        float: right !important;
        margin-left: 15px !important;
        border: 1px solid rgb(20, 71, 167) !important;
    }
    
    .btn-primary-dark{
        background-color: #323741 !important;
        color: rgb(199, 199, 199) !important;
        float: right !important;
        border: 1px solid  #21242b !important;
        margin-left: 15px !important;
        box-shadow: none !important;
    }
    
    
    .message__body{
        text-align: right !important;
        width: 250px !important;
    }
    
    .card-dark{
            background-color: rgb(195, 211, 226) !important;
            border: 0 !important;
    }
    
    
.progress .bg-primary{
    background-color: rgb(45, 95, 189) !important;
    border-radius: 0 !important;
}

.progress .bg-primary-dark{
    background-color: rgb(142, 165, 209) !important;
    border-radius: 0 !important;
}
    .message__body .card{
            background-color: rgb(235, 237, 240) !important;
            border: 0 !important;
        }
    
    .message{
        background-color: transparent !important;
    }
    
    .message-dark{
        background-color: transparent !important;
    }
    
    .teachername{
        color: rgb(1, 36, 59) !important;
        font-weight:700 !important;
        text-decoration: none !important;
        border: 0 !important;
    }
    
    .teachermsg{
        color: rgb(0, 77, 128);
    }
    
    strong{
        border-bottom: none !important;
    }
    
     
    .navbar-dark{
        background-color: #22252c !important;
        border-bottom: 1px solid #1b1d22!important;
    }
    

    .bgg-primary{
        background-color: rgb(63, 0, 82) !important;
    }
    
    .accordion{
        background-color: lightgreen !important;
        border: 0 !important;
    }

    .accordion-dark{
        background-color: lightgreen !important;
        border: 0 !important;
    }

    .accordion__item{
        border-radius: 3px !important;
        border: 0 !important;
    }
    .accordion__item-dark{
        background-color: rgb(13, 17, 20) !important;
    }
    .accordion__item:last-child{
        height: 100% !important;
    }
    .accordion__item-dark:last-child{
        overflow: hidden !important;
    }

    .dots-menu {
  font-size: 15px;
}
.dots-menu.btn-group > .btn:first-child:not(:last-child):not(.dropdown-toggle) {
  border-radius: 5px;
}
.dots-menu a.btn {
 
}
.dots-menu a.btn:active {
  box-shadow: none;
}
.dots-menu ul.dropdown-menu {

}
.dots-menu ul.dropdown-menu li {
}
.dots-menu ul.dropdown-menu li a {
  margin: 0;
}
    
.dropdown-menu::before{
    background-color: none !important;
}
.fleeex{
    display: flex !important;
    flex-direction: column !important;
    max-width: 500px;
}

.crrct{
    position: absolute !important;
    left: 810px !important;
    top: 50px !important;
}
.accordion{
    margin: 0 !important;
    padding: 0 !important
}
.accordion-dark{
        background-color: rgb(59, 109, 216) !important;
        border-bottom: 0!important;
    }

.accordion__toggle.collapsed{
    margin: 0 !important;
}

.accordion__toggle-dark{
    border-bottom: 0 !important;
}
  
.sweet-alert-dark{
            background-color: rgb(158, 171, 179) !important;
        }

</style>

    <div data-push data-responsive-width="768px" data-has-scrollable-region data-fullbleed
         class="mdk-drawer-layout js-mdk-drawer-layout">
        <div class="mdk-drawer-layout__content" data-perfect-scrollbar>
            <div class="app-messages__container d-flex flex-column h-100 pb-4">
                <div class="navbar navbar-dark navbar-expand-sm navbar-shadow z-1" id="messages-navbar">
                    <div class="container-fluid flex-wrap px-sm-0">
                        <div class="nav py-2">
                            <div class="nav-item d-flex align-items-center mr-3" >
                                <div class="d-flex flex-column" style=" font-size: 21px">
                                    <nav class="nav navbar-nav">
                                        <div class="nav-item navbar-list__item">
                                            {% get_current_language as lang %}
                                            {% if lang == "ar" %}
                                            <a href="/courses" class="nav-link h-auto mediabout mediabout-dark"><i
                                                    class="material-icons icon--left mediabout mediabout-dark">keyboard_backspace</i> الرجوع إلى لوحة التحكم</a>
                                            {% else %}
                                            <a href="/courses" class="nav-link h-auto mediabout mediabout-dark"><i
                                                    class="material-icons icon--left mediabout mediabout-dark">keyboard_backspace</i> Back to
                                                Dashboard</a>
                                            {% endif %}    
                                        </div>
                                        <div class="nav-item navbar-list__item">
                                            <div class="d-flex align-items-center flex-nowrap">
                                                <div class="mr-16pt">
                                                    <span class="material-icons sidebar-menu-icon sidebar-menu-icon--left mediabout mediabout-dark">dvr</span>
                                                </div>
                                                <div class="flex">
                                                    <a href="/"
                                                       class=" mb-0 mediabout mediabout-dark" style="font-size: 17px !important;">{{ course.name }}</a>
                                                    <p class="lh-1 d-flex align-items-center mb-0">
                                                        <span class=" small blllu blllu-dark"
                                                              id="cur_video_name"></span>
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </nav> 
                                    {% get_current_language as lang %}
                                    {% if lang == "ar" %}
                                    <div class="fleeex">
                                        <a class="troph-2 mediabout mediabout-dark" href="#" style="margin-right: 30px;"
                                        onclick="openRatingModal()"><b style="font-size: 17px;">أضف تقييم</b> <i class="fa fa-star troph-i mediabout mediabout-dark"></i></a>
                                        <a data-toggle="dropdown" class="troph-2" style="color: rgb(226, 224, 224);font: xx-large;margin-right: 150px;margin-top: 3px;">
                                            <i class="fa fa-bars"></i>
                                        </a>
                                        <!-- <span class="glyphicon glyphicon-option-vertical"> </span>-->
                                        <ul class="dropdown-menu crrct" style="background-color: #afb0b4;">
                                            <li><a href="#" onclick="openSpamModal()"><i class="fa fa-pencil"></i> تبليغ عن محتوى</a></li>
                                            {% if interval < 30 %}
                                            <li><a href="#" onclick="openRefundModal()" ><i class="fa fa-pencil"></i> طلب إسترداد</a></li>
                                            {% endif %}
                                        </ul>
                                        {% if course.type == 0 %}
                                        <p class="troph mediabout mediabout-dark" id="cert" style="cursor:not-allowed !important;" onclick="gotoQuiz()"><b style="font-size: 17px;" >أختبار الحصول على الشهادة</b>  <i
                                                class="fa fa-trophy troph-i"></i></p>
                                        {% endif %}
                                    </div>
                                    
                                    
                                       
                                       
                                    
                                   
                                    {% else %}
                                    <a class="troph-2 mediabout mediabout-dark" href="#" style="margin-left: 45px !important;"
                                       onclick="openRatingModal()">Leave your ratings <i class="fa fa-star troph-i mediabout mediabout-dark"></i></a>
                                    <a href="#"
                                       style="margin-left: 45px !important; position: absolute;top: 20px;font-size: small;right: 360px;"
                                       onclick="openSpamModal()" class="mediabout mediabout-dark">Report Spam <i class="fa fa-file troph-i"
                                                                                style="color: rgb(219, 135, 135)"></i></a>
                                    {% if interval < 30 %}
                                        <a href="#"
                                           style="margin-left: 45px !important; position: absolute;top: 20px;font-size: small;right: 500px;"
                                           onclick="openRefundModal()" class="mediabout mediabout-dark">Refund Money <i class="fa fa-money-bill troph-i"
                                                                                       style="color: rgb(147, 231, 185)"></i></a>
                                    {% endif %}
                                    {% if course.type == 0 %}
                                    <p class="troph mediabout mediabout-dark" id="cert" style="cursor:not-allowed !important;" onclick="gotoQuiz()">Get your certificate <i
                                            class="fa fa-trophy troph-i"></i></p>
                                    {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="py-2 flex d-flex align-items-center">
                            <button data-target="#messages-drawer" class="navbar-toggler d-block d-md-none ml-3 p-0"
                                    data-toggle="sidebar" type="button">
                                <i class="material-icons">people_outline</i>
                            </button>
                        </div>
                    </div>
                </div>
                <div id="show" class="">
                    <div class="app-video" style="height: 92% !important">
                        <video autoplay poster="{% static 'assets/img/setting.jpg' %}" id="player" playsinline controls>
                            <source type="video/webm" src="../../../../static{{ first_video.url }}"/>
                            <!-- Captions are optional -->
                            <track kind="captions" label="English captions" src="/path/to/captions.vtt" srclang="en"
                                   default/>
                        </video>
                    </div>
                    <div class=" page__container page__container page__container-2 card-footer card-footer-dark" style="width: 100%;height: 100px !important;border-radius: 0 !important;">
                        <form action="#" id="message-reply" class="form-down-2 ">
                            <div class="progress"
                                 style="height: 10px;margin-top: 25px; width: 50%;border-radius: 10px;">
                                <div class="progress-bar progress-bar-striped bg-primary bg-primary-dark" role="progressbar"
                                     id="progress"
                                     style="width: 75%;height: 10px;" aria-valuenow="10" aria-valuemin="0"
                                     aria-valuemax="100"></div>
                            </div>
                            <span style="font-weight: 500;margin-left: 30px;margin-top: 20px;"
                                  id="showProgress" class="mediabout mediabout-dark"> 2 / 30</span>
                            <i class="fa fa-trophy mediabout mediabout-dark" id="medal"
                               style="margin-right: 10px;margin-left: 5px;font-size: large;margin-top: 20px;"></i>

                               {% get_current_language as lang %}
                               {% if lang == "ar" %}
                            <button type="button" id="videoPrevBtn" class="btn flex btn-primary btn-primary-dark"
                                    style=" width: 40%;margin:0 auto;margin-top: 30px;"
                                    onclick="previousinlist()"
                            >السابق
                            </button>
                            <button type="button" id="videoNextBtn" class="btn flex btn-primary btn-primary-dark"
                                    style="width: 40%;margin:0 auto;margin-top: 30px;"
                                    onclick="nextinlist()"
                            >التالي
                            </button>
                            {% else %}
                            <button type="button" id="videoPrevBtn" class="btn flex btn-primary btn-primary-dark"
                                    style=" width: 40%;margin:0 auto;margin-top: 30px;"
                                    onclick="previousinlist()"
                            >Previous
                            </button>
                            <button type="button" id="videoNextBtn" class="btn flex btn-primary btn-primary-dark"
                                    style="width: 40%;margin:0 auto;margin-top: 30px;"
                                    onclick="nextinlist()"
                            >Next
                            </button>
                            {% endif %}
                        </form>
                    </div>
                </div>
                <div id="lock" class="d-none">
                    <h1 class="text-center" style="margin-top: 100px;">This Video is Locked Now.</h1>
                    <h2 class="text-center" style="margin-top: 20px;" id="alarm">78 hr 34 min 23 Secs Left</h2>
                </div>

            </div>
        </div>
        <div class="mdk-drawer js-mdk-drawer" data-align="end" id="messages-drawer">
            <div class="mdk-drawer__content top-0">
                <div class="sidebar sidebar-dark sidebar-right o-hidden">
                    <div class="d-flex flex-column h-100">
                        <div style="margin-top: 30px;" class="flex" data-perfect-scrollbar>
                            <div class="sidebar-headig"
                                 style="width: 100%;position: fixed;top: 0;right: 0;height: 50px !important; z-index: 99999;">
                                 {% get_current_language as lang %}
                                 {% if lang == "ar" %}
                                <b style="top:12px;position:absolute;right:20px;font-size: 20px;font-weight: 700;" class="mediabout mediabout-dark">محتوى الدورة</b>
                                {% else %}
                                <b style="top:12px;position:absolute;left:20px">Course curriculum</b>

                                {% endif %}
                            </div>
                            <hr>
                            <ul class="list-group mb-3" style="">
                                    {% for ele in section_list %}
                                    <div class="accordion accordion-dark " id="parent">
                                        <div class="accordion__item accordion__item-dark">
                                            <a href="#" class="accordion__toggle accordion__toggle-dark collapsed" data-toggle="collapse"
                                               data-target="#course-toc-{{ ele.id }}" data-parent="#parent">
                                                <span class="flex mediabout mediabout-dark">{{ ele.name }}</span>
                                                <span class="accordion__toggle-icon material-icons mediabout mediabout-dark">keyboard_arrow_down</span>
                                            </a>
                                            <div class="accordion__menu collapse" id="course-toc-{{ ele.id }}">
                                                {% if ele.videoList %}
                                                    {% for i in ele.videoList %}
                                                        <div class="accordion__menu-link" style="cursor: pointer;">
                                                            <i class="material-icons icon-16pt tick{{ i.id }}"
                                                               data-lock="{{ i.lock }}"
                                                               onclick="checkThis(this)" data-sr_no="{{ i.sr_no }}"
                                                               id="icon_first">check_circle</i> &nbsp
                                                            <div data-id="{{ i.id }}" data-srno="{{ i.sr_no }}"
                                                                 data-lock="{{ i.lock }}" data-left="{{ i.count_left }}"
                                                                 data-url="{{ i.url }}"
                                                                 class="flex videourl v{{ forloop.parentloop.counter }}"
                                                                 onclick="playmyvideo(this)"
                                                                 id="name_first">{{ i.video_name }}</div>
                                                        </div>
                                                    {% endfor %}
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="sweet-overlay" tabindex="-1" style="" id="rating_modal_back"></div>

    {% get_current_language as lang %}
    {% if lang == "ar" %}
    <div class="sweet-alert sweet-alert-dark showSweetAlert visible" data-custom-class="" data-has-cancel-button="false"
         id="rating_modal"
         data-has-confirm-button="true" data-allow-outside-click="false" data-has-done-function="true"
         data-animation="pop" data-timer="null" style="display: none; margin-top: -144px;">
        <input type="hidden" id="commentId" value="">
        <input type="hidden" id="commentType" value="">
        <div class="modal-header">
            <h5 class="modal-title" id="formModal">أضف تعليقك و تقييمك للدورة</h5>
            <button style=" float: right; margin-top: -30px; margin-bottom: 10px;outline: none; background: no-repeat;border: none;font-size: 20px;"
                    type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <h5 class="modal-title" style="margin-bottom: 5px;">ماهو تقييمك للدورة؟</h5>
            <div class="input-group leaverating justify-content-center align-content-center"
                 style="border: 1px solid black; height: 70px; margin-bottom: 5px;">
                <fieldset class="rate" id="rating_value">
                    <input type="radio" id="rating10" name="rating" value="5"/><label for="rating10"
                                                                                      title="5 stars"></label>
                    <input type="radio" id="rating9" name="rating" value="4.5"/><label class="half" for="rating9"
                                                                                       title="4 1/2 stars"></label>
                    <input type="radio" id="rating8" name="rating" value="4"/><label for="rating8"
                                                                                     title="4 stars"></label>
                    <input type="radio" id="rating7" name="rating" value="3.5"/><label class="half" for="rating7"
                                                                                       title="3 1/2 stars"></label>
                    <input type="radio" id="rating6" name="rating" value="3"/><label for="rating6"
                                                                                     title="3 stars"></label>
                    <input type="radio" id="rating5" name="rating" value="2.5"/><label class="half" for="rating5"
                                                                                       title="2 1/2 stars"></label>
                    <input type="radio" id="rating4" name="rating" value="2"/><label for="rating4"
                                                                                     title="2 stars"></label>
                    <input type="radio" id="rating3" name="rating" value="1.5"/><label class="half" for="rating3"
                                                                                       title="1 1/2 stars"></label>
                    <input type="radio" id="rating2" name="rating" value="1"/><label for="rating2"
                                                                                     title="1 star"></label>
                    <input type="radio" id="rating1" name="rating" value="0.5"/><label class="half" for="rating1"
                                                                                       title="1/2 star"></label>
                </fieldset>
            </div>
            <h5 class="modal-title" style="margin-bottom: 15px; margin-top: 10px;">تعليقك عن الدورة؟</h5>
            <div class="input-group" style="margin-bottom: 5px;">
                <textarea id="comment" style="height: 150px; overflow-y: auto;" class="form-control"
                          placeholder="أكتب تعليقك"></textarea>
            </div>
            <button style="color:#fff;background: #62adeb;" type="button" onclick="saveRating()"
                    class="btn">تقييم
            </button>
            <button style="color:#fff;background: #f1a49f;" type="button" onclick="hideModal()"
                    class="btn">إغلاق
            </button>
        </div>
    </div>
    {% else %}
    <div class="sweet-alert showSweetAlert visible" data-custom-class="" data-has-cancel-button="false"
         id="rating_modal"
         data-has-confirm-button="true" data-allow-outside-click="false" data-has-done-function="true"
         data-animation="pop" data-timer="null" style="display: none; margin-top: -144px;">
        <input type="hidden" id="commentId" value="">
        <input type="hidden" id="commentType" value="">
        <div class="modal-header">
            <h5 class="modal-title" id="formModal">Leave your rating and comment here!</h5>
            <button style=" float: right; margin-top: -30px; margin-bottom: 10px;outline: none; background: no-repeat;border: none;font-size: 20px;"
                    type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <h5 class="modal-title" style="margin-bottom: 5px;">Give a rating. Max is Very Good!</h5>
            <div class="input-group leaverating justify-content-center align-content-center"
                 style="border: 1px solid black; height: 70px; margin-bottom: 5px;">
                <fieldset class="rate" id="rating_value">
                    <input type="radio" id="rating10" name="rating" value="5"/><label for="rating10"
                                                                                      title="5 stars"></label>
                    <input type="radio" id="rating9" name="rating" value="4.5"/><label class="half" for="rating9"
                                                                                       title="4 1/2 stars"></label>
                    <input type="radio" id="rating8" name="rating" value="4"/><label for="rating8"
                                                                                     title="4 stars"></label>
                    <input type="radio" id="rating7" name="rating" value="3.5"/><label class="half" for="rating7"
                                                                                       title="3 1/2 stars"></label>
                    <input type="radio" id="rating6" name="rating" value="3"/><label for="rating6"
                                                                                     title="3 stars"></label>
                    <input type="radio" id="rating5" name="rating" value="2.5"/><label class="half" for="rating5"
                                                                                       title="2 1/2 stars"></label>
                    <input type="radio" id="rating4" name="rating" value="2"/><label for="rating4"
                                                                                     title="2 stars"></label>
                    <input type="radio" id="rating3" name="rating" value="1.5"/><label class="half" for="rating3"
                                                                                       title="1 1/2 stars"></label>
                    <input type="radio" id="rating2" name="rating" value="1"/><label for="rating2"
                                                                                     title="1 star"></label>
                    <input type="radio" id="rating1" name="rating" value="0.5"/><label class="half" for="rating1"
                                                                                       title="1/2 star"></label>
                </fieldset>
            </div>
            <h5 class="modal-title" style="margin-bottom: 15px; margin-top: 10px;">Leave your Comment here!</h5>
            <div class="input-group" style="margin-bottom: 5px;">
                <textarea id="comment" style="height: 150px; overflow-y: auto;" class="form-control"
                          placeholder="content"></textarea>
            </div>
            <button style="color:#fff;background: #2196f3;" type="button" onclick="saveRating()"
                    class="btn">Save
            </button>
            <button style="color:#fff;background: #f5837a;" type="button" onclick="hideModal()"
                    class="btn">Close
            </button>
        </div>
    </div>
    {% endif %}

    {% get_current_language as lang %}
    {% if lang == "ar" %}
    <div class="sweet-alert showSweetAlert visible" data-custom-class="" data-has-cancel-button="false"
         id="refund_modal"
         data-has-confirm-button="true" data-allow-outside-click="false" data-has-done-function="true"
         data-animation="pop" data-timer="null" style="display: none; margin-top: -144px;">
        <div class="modal-header">
            <h5 class="modal-title" id="formModal">ماهو سبب طلب استرداد المبلغ؟</h5>
            <button style=" float: right; margin-top: -30px; margin-bottom: 10px;outline: none; background: no-repeat;border: none;font-size: 20px;"
                    type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <h5 class="modal-title" style="margin-bottom: 5px;">العنوان</h5>
            <input type="text" id="refund_title" style="display: block !important;" placeholder="title">
            <h5 class="refund-title" style="margin-bottom: 5px;">الرسالة</h5>
            <div class="input-group" style="margin-bottom: 5px;">
                <textarea id="refund_content" style="height: 150px; overflow-y: auto;" class="form-control"
                          placeholder="content"></textarea>
            </div>
            <button style="color:#fff;background: #2196f3;" type="button" onclick="refund()"
                    class="btn">Save
            </button>
            <button style="color:#fff;background: #f5837a;" type="button" onclick="hideRefundModal()"
                    class="btn">Close
            </button>
        </div>
    </div>

    <div class="sweet-alert showSweetAlert visible" data-custom-class="" data-has-cancel-button="false"
         id="spam_modal"
         data-has-confirm-button="true" data-allow-outside-click="false" data-has-done-function="true"
         data-animation="pop" data-timer="null" style="display: none; margin-top: -144px;">
        <div class="modal-header">
            <h5 class="spam-title" id="formModal">قم بالتبليغ عن المحتوى</h5>
            <button style=" float: right; margin-top: -30px; margin-bottom: 10px;outline: none; background: no-repeat;border: none;font-size: 20px;"
                    type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <h5 class="modal-title" style="margin-bottom: 5px;">عنوان البلاغ</h5>
            <input type="text" id="spam_title" style="display: block !important;" placeholder="title">
        </div>
        <h5 class="modal-title" style="margin-bottom: 5px;">الرسالة</h5>
        <div class="input-group" style="margin-bottom: 5px;">
                <textarea id="spam_content" style="height: 150px; overflow-y: auto;" class="form-control"
                          placeholder="content"></textarea>
        </div>
        <button style="color:#fff;background: #2196f3;" type="button" onclick="reportSpam()"
                class="btn">Save
        </button>
        <button style="color:#fff;background: #f5837a;" type="button" onclick="hideSpamModal()"
                class="btn">Close
        </button>
    </div>
    {% else %}
    <div class="sweet-alert showSweetAlert visible" data-custom-class="" data-has-cancel-button="false"
         id="refund_modal"
         data-has-confirm-button="true" data-allow-outside-click="false" data-has-done-function="true"
         data-animation="pop" data-timer="null" style="display: none; margin-top: -144px;">
        <div class="modal-header">
            <h5 class="modal-title" id="formModal">Leave your Refund title and comment here!</h5>
            <button style=" float: right; margin-top: -30px; margin-bottom: 10px;outline: none; background: no-repeat;border: none;font-size: 20px;"
                    type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <h5 class="modal-title" style="margin-bottom: 5px;">Refund title</h5>
            <input type="text" id="refund_title" style="display: block !important;" placeholder="title">
            <h5 class="refund-title" style="margin-bottom: 5px;">Refund content</h5>
            <div class="input-group" style="margin-bottom: 5px;">
                <textarea id="refund_content" style="height: 150px; overflow-y: auto;" class="form-control"
                          placeholder="content"></textarea>
            </div>
            <button style="color:#fff;background: #2196f3;" type="button" onclick="refund()"
                    class="btn">Save
            </button>
            <button style="color:#fff;background: #f5837a;" type="button" onclick="hideRefundModal()"
                    class="btn">Close
            </button>
        </div>
    </div>

    <div class="sweet-alert showSweetAlert visible" data-custom-class="" data-has-cancel-button="false"
         id="spam_modal"
         data-has-confirm-button="true" data-allow-outside-click="false" data-has-done-function="true"
         data-animation="pop" data-timer="null" style="display: none; margin-top: -144px;">
        <div class="modal-header">
            <h5 class="spam-title" id="formModal">Leave your Spam Title and comment here!</h5>
            <button style=" float: right; margin-top: -30px; margin-bottom: 10px;outline: none; background: no-repeat;border: none;font-size: 20px;"
                    type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <h5 class="modal-title" style="margin-bottom: 5px;">Spam Title</h5>
            <input type="text" id="spam_title" style="display: block !important;" placeholder="title">
        </div>
        <h5 class="modal-title" style="margin-bottom: 5px;">Spam Comment</h5>
        <div class="input-group" style="margin-bottom: 5px;">
                <textarea id="spam_content" style="height: 150px; overflow-y: auto;" class="form-control"
                          placeholder="content"></textarea>
        </div>
        <button style="color:#fff;background: #2196f3;" type="button" onclick="reportSpam()"
                class="btn">Save
        </button>
        <button style="color:#fff;background: #f5837a;" type="button" onclick="hideSpamModal()"
                class="btn">Close
        </button>
    </div>
    {% endif %}

    <div class="sweet-alert showSweetAlert visible" data-custom-class="" data-has-cancel-button="false"
         id="result_modal"
         data-has-confirm-button="true" data-allow-outside-click="false" data-has-done-function="true"
         data-animation="pop" data-timer="null" style="display: none; margin-top: -169px;">
        <div class="sa-icon sa-warning pulseWarning" style="display: none;">
          <span class="sa-body pulseWarningIns"></span>
          <span class="sa-dot pulseWarningIns"></span>
        </div>
        <div class="sa-icon sa-success animate" style="display: block;">
            <span class="sa-line sa-tip animateSuccessTip"></span>
            <span class="sa-line sa-long animateSuccessLong"></span>
            <div class="sa-placeholder"></div>
            <div class="sa-fix"></div>
        </div>
        <div class="sa-icon sa-custom" style="display: none;"></div>
        <h2 id="result_title">Success!</h2>
        <p style="display: block;" id="result_content">Thanks!</p>
        <fieldset>
            <input type="text" tabindex="3" placeholder="">
            <div class="sa-input-error"></div>
        </fieldset>
        <div class="sa-error-container">
            <div class="icon">!</div>
            <p>Not valid!</p>
        </div>
        <div class="sa-button-container">
            <button class="cancel" tabindex="2" style="display: none; box-shadow: none;">Cancel</button>
            <div class="sa-confirm-button-container">
                <button class="confirm" tabindex="1" onclick="hideResultModal()"
                        style="display: inline-block; background-color: rgb(33, 150, 243); box-shadow: rgba(33, 150, 243, 0.8) 0px 0px 2px, rgba(0, 0, 0, 0.05) 0px 0px 0px 1px inset;">
                    OK
                </button>
                <div class="la-ball-fall">
                    <div></div>
                    <div></div>
                    <div></div>
                </div>
            </div>
        </div>
    </div>

    <script>

        let memory;
        let video = $(".app-video video")[0]
        let user_id = '{{ request.user.id }}'
        let course_id = '{{ course_id }}'
        let key = user_id + '-' + course_id
        let cache_str = '{{ cache_str }}'
        let count_down = '{{ count_down }}'
        let minus_count = 0
        let count = 0

        function gotoQuiz() {
            location = '/quiz/{{ course.course_url }}/{{ quiz_id }}';
        }

        function saveCache() {
            let url = '/save_cache_str/'
            let cache_str = JSON.stringify(memory)
            let form_data = new FormData()
            form_data.append('cache_str', cache_str)
            form_data.append('key', key)
            $.ajax({
                url: url,
                type: 'POST',
                dataType: 'json',
                async: false,
                contentType: false,
                processData: false,
                data: form_data,
            })
        }

        window.onbeforeunload = function (event) {
            //localStorage.setItem(key, JSON.stringify(memory))
        };

        var countDownThread1 = setInterval(() => {
            minus_count++
        }, 1000)

        var countDownThread2 = setInterval(() => {
            count--
            count2 = count
            html = ''
            if (count2 > 3600 * 24) {
                html += Math.floor(count2 / 3600 / 24) + 'Days  '
            }
            count2 -= Math.floor(count2 / 3600 / 24) * 3600 * 24
            if (count2 > 3600) {
                html += Math.floor(count2 / 3600) + 'Hours  '
            }
            count2 -= Math.floor(count2 / 3600) * 3600
            if (count2 > 60) {
                html += Math.floor(count2 / 60) + 'Mins  '
            }
            count2 -= Math.floor(count2 / 60) * 60
            html += count2 + 'Secs  Left'
            $("#alarm").html(html)
        }, 1000)

        function showList() {
            $(".accordion__menu-link").each(function () {
                no = $(this).find("i").data('sr_no')
                if (memory.checkList[no - 1]) {
                    $(this).find("i").css({
                        color: '#0164c0'
                    })
                    $(this).find("i").html('check_circle')
                } else {
                    if ($(this).find("i").data('lock') * 1 == 0)
                        $(this).find("i").html('radio_button_unchecked')
                    else
                        $(this).find("i").html('lock')
                }
            })
        }

        function restoreMemory() {
            showList()
            sum = 0
            for (let i = 0; i < memory.checkList.length; i++)
                sum += memory.checkList[i]
            $("#showProgress").html(sum + '/' + memory.checkList.length)
            prog = sum / memory.checkList.length * 100;
            $('#progress').css('width', prog + '%');

            if (checkComplete()) {
                $("#cert").removeAttr("style")
                $("#cert").attr('style', 'cursor: pointer !important; color: #de8413')
                $("#medal").css({
                    'color': '#de8413',
                })
            }
            obj = $(`[data-srno=${memory.cur_video}]`)
            playmyvideo(obj)
        }

        $(document).ready(function () {
            if (cache_str == '') {
                len = $(".accordion__menu-link").length
                checkList = new Array(len)
                for (let i = 0; i < len; i++)
                    checkList[i] = 0
                memory = {
                    'checkList': checkList,
                    'cur_video': 1
                }
            } else {
                memory = JSON.parse(cache_str.replace(/&quot;/g, '\"'))
            }
            restoreMemory()
            video.addEventListener("timeupdate", handleTimeupdate)
        });

        function checkComplete() {
            sum = 0
            for (let i = 0; i < memory.checkList.length; i++)
                sum += memory.checkList[i]
            if (sum == memory.checkList.length) return true;
            else return false;
        }

        function checkThis(obj) {
            if ($(obj).data('lock') * 1 == 1)
                return;
            video_no = $(obj).data('sr_no')
            memory.checkList[video_no - 1] = (memory.checkList[video_no - 1] + 1) % 2
            if (memory.checkList[video_no - 1]) {
                $(obj).css({
                    color: '#0164c0'
                })
                $(obj).html('check_circle')
            } else {
                $(obj).css({
                    color: ''
                })
                $(obj).html('radio_button_unchecked')
            }
            cnt = 0
            console.log("test::", memory.checkList)
            memory.checkList.forEach(ele => {
                if (ele == 1)
                    cnt++;
            })
            prog = cnt / memory.checkList.length * 100;
            $('#progress').css('width', prog + '%');
            $("#showProgress").html(cnt + '/' + memory.checkList.length)
            if (checkComplete()) {
                $("#cert").removeAttr("style")
                $("#cert").attr('style', 'cursor: pointer !important; color: #de8413')
                $("#medal").css({
                    'color': '#de8413',
                })
            } else {
                $("#cert").attr('style', '')
                $("#medal").css({
                    'color': ''
                })
            }
            saveCache()
        }

        function openRatingModal() {
            let url = '/get_rating/'
            let student_id = '{{ request.user.id }}'
            let course_id = '{{ course_id }}'
            let form_data = new FormData()
            form_data.append('course_id', course_id)
            form_data.append('student_id', student_id)
            $.ajax({
                url: url,
                type: 'POST',
                dataType: 'json',
                async: false,
                contentType: false,
                processData: false,
                data: form_data,
            }).then(response =>{
                rating = parseFloat(response.rating + "")
                {#document.querySelector('#rating'+(rating/0.5)).checked = true;#}
                $("#rating"+(rating/0.5)).attr('checked', true)
                $("#comment").val(response.comment)
                console.log("result::", response)
                $("#rating_modal").css({
                'display': 'block'
                })
                $("#rating_modal_back").css({
                    'display': 'block'
                })
            })
        }

        function openSpamModal() {
            $("#spam_modal").css({
                'display': 'block'
            })
            $("#rating_modal_back").css({
                'display': 'block'
            })
        }

        function openRefundModal() {
            $("#refund_modal").css({
                'display': 'block'
            })
            $("#rating_modal_back").css({
                'display': 'block'
            })
        }

        function openResultModal() {
            $("#result_modal").css({
                'display': 'block'
            })
        }

        function hideResultModal() {
            $("#result_modal").css({
                'display': 'none'
            })
            return true
        }

        function hideModal() {
            $("#rating_modal").css({
                'display': 'none'
            })
            $("#rating_modal_back").css({
                'display': 'none'
            })
            $("#comment").val('')
        }

        function hideRefundModal() {
            $("#refund_modal").css({
                'display': 'none'
            })
            $("#rating_modal_back").css({
                'display': 'none'
            })
            $("#refund_title").val('')
            $("#refund_content").val('')
        }

        function hideSpamModal() {
            $("#spam_modal").css({
                'display': 'none'
            })
            $("#rating_modal_back").css({
                'display': 'none'
            })
            $("#spam_title").val('')
            $("#spam_content").val('')
        }

        function refund() {
            let url = '/refund/'
            let student_id = '{{ request.user.id }}'
            let teacher_id = '{{ teacher_id }}'
            let course_id = '{{ course_id }}'
            let title = $("#refund_title").val()
            let content = $("#refund_content").val()
            let form_data = new FormData()
            form_data.append('course_id', course_id)
            form_data.append('student_id', student_id)
            form_data.append('teacher_id', teacher_id)
            form_data.append('title', title)
            form_data.append('content', content)
            $.ajax({
                url: url,
                type: 'POST',
                dataType: 'json',
                async: false,
                contentType: false,
                processData: false,
                data: form_data,
            }).then(response => {
                if (response.status == 1){
                    $(".sa-success").css({
                        'display': 'block'
                    })
                    $(".sa-warning").css({
                        'display': 'none'
                    })
                    $("#result_title").html("SUCCESS!")
                    $("#result_content").html("Thanks for your submitting Refund")
                    openResultModal()
                    hideRefundModal()
                } else if (response.status == 2) {
                    $(".sa-success").css({
                        'display': 'none'
                    })
                    $(".sa-warning").css({
                        'display': 'block'
                    })
                    $("#result_title").html("WARNING!")
                    $("#result_content").html("You already request refund")
                    openResultModal()
                    hideRefundModal()
                }
            })
        }

        function reportSpam() {
            let url = '/report_spam/'
            let student_id = '{{ request.user.id }}'
            let teacher_id = '{{ teacher_id }}'
            let course_id = '{{ course_id }}'
            let title = $("#spam_title").val()
            let content = $("#spam_content").val()
            let form_data = new FormData()
            form_data.append('course_id', course_id)
            form_data.append('student_id', student_id)
            form_data.append('teacher_id', teacher_id)
            form_data.append('title', title)
            form_data.append('content', content)
            $.ajax({
                url: url,
                type: 'POST',
                dataType: 'json',
                async: false,
                contentType: false,
                processData: false,
                data: form_data,
            }).then(response => {
                if (response.status == 1) {
                    $("#result_content").html("Thanks for your submitting Report")
                    openResultModal()
                    hideSpamModal()
                }
            })
        }

        function saveRating() {
            let url = '/save_rating/'
            let student_id = '{{ request.user.id }}'
            let course_id = '{{ course_id }}'
            let rating = parseFloat($('input[name="rating"]:checked').val());
            let comment = $("#comment").val()
            let form_data = new FormData()
            form_data.append('course_id', course_id)
            form_data.append('student_id', student_id)
            form_data.append('rating', rating)
            form_data.append('comment', comment)
            $.ajax({
                url: url,
                type: 'POST',
                dataType: 'json',
                async: false,
                contentType: false,
                processData: false,
                data: form_data,
            }).then(response => {
                if(response.status*1 == 1) {
                    $("#result_content").html("Thanks for your rating this course")
                    openResultModal()
                    hideModal()
                }
            })
        }

        function saveRating1() {
            var comment = $('textarea#comment').val();
            console.log("Comment is: " + comment);
            user_id = '{{ request.user.id }}';
            course_id = '{{ course_id }}';
            rating = parseInt($("#ratinginteger").attr("data-value"));
            comment_id = ''
            $.ajax({
                method: "POST",
                url: "/add_comment/",
                data: {
                    'comment': comment,
                    'user_id': user_id,
                    'course_id': course_id,
                    'comment_id': comment_id,
                    'rating': rating
                },
                success: function (response) {
                    if (response == "success") {
                        swal("Added successfully!", {
                            button: "Ok",
                            closeOnClickOutside: false,
                        });
                        $('#exampleModal4').modal('hide');
                    }
                }
            });
        }

        function playmyvideo(cname) {
            if ($(cname).data('lock') * 1 == 1) {
                $("#show").addClass("d-none")
                $("#lock").removeClass("d-none")
                count = $(cname).data('left') * (-1) - minus_count
                return;
            } else {
                $("#show").removeClass("d-none")
                $("#lock").addClass("d-none")
            }
            $(".videourl").removeClass("current");
            var dataurl = $(cname).attr("data-url");
            var srno = $(cname).attr("data-srno");
            memory.cur_video = srno * 1
            let cur_video_name = $(cname).html().split('.')
            cur_video_name.pop()
            $("#cur_video_name").html(cur_video_name.toString())
            $(".app-video video source").attr("src", "../../../../static" + dataurl)
            console.log("here")
            $(".app-video video")[0].load();
            console.log("here1")
            $(".list-group .flex").removeAttr("style")
            $(cname).css({"color": "rgb(1, 100, 192)"});

            showList()
            $(`[data-sr_no=${memory.cur_video}]`).css({
                color: '#9f0233'
            })
            $(`[data-sr_no=${memory.cur_video}]`).html('play_circle_outline')
            saveCache()
        }

        function previousinlist() {
            if ($(`[data-srno=${memory.cur_video - 1}]`).data('lock') * 1 == 1) {
                $("#show").addClass("d-none")
                $("#lock").removeClass("d-none")
                return;
            } else {
                $("#show").removeClass("d-none")
                $("#lock").addClass("d-none")
            }
            if (memory.cur_video <= 2) {
                $("#videoPrevBtn").css({
                    'cursor': 'not-allowed'
                })
            } else {
                $("#videoPrevBtn").css({
                    'cursor': 'pointer'
                })
                $("#videoNextBtn").css({
                    'cursor': 'pointer'
                })
            }
            if (memory.cur_video <= 1) {
                return;
            }
            memory.cur_video = memory.cur_video - 1
            dataurl = $(`[data-srno=${memory.cur_video}]`).data('url')
            videoname = $(`[data-srno=${memory.cur_video}]`).html().split('.')
            videoname.pop()
            $("#cur_video_name").html(videoname.toString())
            $(".app-video video source").attr("src", "../../../../static" + dataurl)
            $(".app-video video")[0].load();
            console.log("memory", memory)
            $(".list-group .flex").removeAttr("style")
            $(`[data-srno=${memory.cur_video}]`).css({"color": "rgb(1, 100, 192)"});
            showList()
            $(`[data-sr_no=${memory.cur_video}]`).css({
                color: '#9f0233'
            })
            $(`[data-sr_no=${memory.cur_video}]`).html('play_circle_outline')
            saveCache()
        }

        function nextinlist() {
            if ($(`[data-srno=${memory.cur_video + 1}]`).data('lock') * 1 == 1) {
                $("#show").addClass("d-none")
                $("#lock").removeClass("d-none")
                return;
            } else {
                $("#show").removeClass("d-none")
                $("#lock").addClass("d-none")
            }
            if (memory.cur_video >= memory.checkList.length - 1) {
                $("#videoNextBtn").css({
                    'cursor': 'not-allowed'
                })
            } else {
                $("#videoNextBtn").css({
                    'cursor': 'pointer'
                })
                $("#videoPrevBtn").css({
                    'cursor': 'pointer'
                })
            }
            if (memory.cur_video >= memory.checkList.length) {
                return;
            }
            memory.cur_video = memory.cur_video + 1
            dataurl = $(`[data-srno=${memory.cur_video}]`).data('url')
            videoname = $(`[data-srno=${memory.cur_video}]`).html().split('.')
            videoname.pop()
            $("#cur_video_name").html(videoname.toString())
            $(".app-video video source").attr("src", "../../../../static" + dataurl)
            $(".app-video video")[0].load();
            console.log("memory test::", memory)
            $(".list-group .flex").removeAttr("style")
            $(`[data-srno=${memory.cur_video}]`).css({"color": "rgb(1, 100, 192)"});
            showList()
            $(`[data-sr_no=${memory.cur_video}]`).css({
                color: '#9f0233'
            })
            $(`[data-sr_no=${memory.cur_video}]`).html('play_circle_outline')
            saveCache()
        }

        function handleTimeupdate(e) {
            rest = video.duration - video.currentTime
            if (rest < 10 && !memory.checkList[memory.cur_video - 1]) {
                memory.checkList[memory.cur_video - 1] = 1
                $(`[data-sr_no=${memory.cur_video}]`).css({
                    color: '#0164c0'
                })
                $(`[data-sr_no=${memory.cur_video}]`).html('check_circle')
                sum = 0
                for (let i = 0; i < memory.checkList.length; i++)
                    sum += memory.checkList[i]
                $("#showProgress").html(sum + '/' + memory.checkList.length)
                prog = sum / memory.checkList.length * 100;
                $('#progress').css('width', prog + '%');
                if (checkComplete()) {
                    $("#cert").removeAttr("style")
                    $("#cert").attr('style', 'cursor: pointer !important; color: #de8413')
                    $("#medal").css({
                        'color': '#de8413',
                    })
                } else {
                    $("#cert").attr('style', '')
                    $("#medal").css({
                        'color': ''
                    })
                }
                saveCache()
            }
            if (video.duration == video.currentTime) {
                nextinlist()
            }
        }

    </script>
{% endblock %}



