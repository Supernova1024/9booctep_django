{% load static %}
<!doctype html>
<html lang="en" dir="ltr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Forget Password</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- inject:css-->

    <link rel="stylesheet" href="{% static 'assets/vendor_assets/css/bootstrap/bootstrap.css' %}">

    <link rel="stylesheet" href="{% static 'assets/vendor_assets/css/daterangepicker.css' %}">

    <link rel="stylesheet" href="{% static 'assets/vendor_assets/css/fontawesome.css' %}">

    <link rel="stylesheet" href="{% static 'assets/vendor_assets/css/fullcalendar@5.2.0.css' %}">

    <link rel="stylesheet" href="{% static 'assets/vendor_assets/css/jquery-jvectormap-2.0.5.css' %}">

    <link rel="stylesheet" href="{% static 'assets/vendor_assets/css/jquery.mCustomScrollbar.min.css' %}">

    <link rel="stylesheet" href="{% static 'assets/vendor_assets/css/leaflet.css' %}">

    <link rel="stylesheet" href="{% static 'assets/vendor_assets/css/line-awesome.min.css' %}">

    <link rel="stylesheet" href="{% static 'assets/vendor_assets/css/magnific-popup.css' %}">

    <link rel="stylesheet" href="{% static 'assets/vendor_assets/css/MarkerCluster.css' %}">

    <link rel="stylesheet" href="{% static 'assets/vendor_assets/css/MarkerCluster.Default.css' %}">

    <link rel="stylesheet" href="{% static 'assets/vendor_assets/css/select2.min.css' %}">

    <link rel="stylesheet" href="{% static 'assets/vendor_assets/css/slick.css' %}">

    <link rel="stylesheet" href="{% static 'assets/vendor_assets/css/star-rating-svg.css' %}">

    <link rel="stylesheet" href="{% static 'assets/vendor_assets/css/trumbowyg.min.css' %}">

    <link rel="stylesheet" href="{% static 'assets/vendor_assets/css/wickedpicker.min.css' %}">

    <link rel="stylesheet" href="{% static 'assets/style.css' %}">

    <style>
        .my_div_err {
            background: #a45858;
            height: 40px;
            border-radius: 7px;
            color: white;
            display: flex;
        }
        .my_div_success {
            background: #85c186;
            height: 40px;
            border-radius: 7px;
            color: white;
            display: flex;
        }
    </style>

</head>

<body>
<main class="main-content d-none" id="success" style="background:#fff !important">
<div class="signUP-admin">
    <div class="container-fluid">
          <div class="row justify-content-center">
              <div class="col-xl-8 col-lg-7 col-md-7 col-sm-8">
                  <div class="signUp-admin-right signIn-admin-right  p-md-40 p-10">
                      <div class="row justify-content-center">
                          <div class="col-xl-7 col-lg-8 col-md-12">
                              <div class="edit-profile mt-md-25 mt-0">
                                  <div class="card border-0">
                                      <div class="card-header border-0 pt-0 pb-0">
                                          <div class="signUp-header-top mt-md-0 mt-30">
                                              <h6>Reset your password</h6>
                                              <p class="mt-md-45 mt-20">Enter the new password please. {{ key }} </p>
                                          </div>
                                      </div>
                                      <div class="card-body pt-20 pb-0">
                                          <div class="edit-profile__body">
                                              <div class="mb-10 my_div_err justify-content-center align-items-center d-none"
                                                     id="password-err">
                                                    Password Error
                                              </div>
                                              <div class="mb-10 my_div_success justify-content-center align-items-center d-none"
                                                     id="password-success">
                                                    Your Password Has Been Changed Successfully
                                              </div>
                                              <div class="form-group mb-20">
                                                  <label for="password">new password</label>
                                                  <input type="password" class="form-control" id="password" placeholder="">
                                              </div>
                                              <div class="form-group mb-20">
                                                  <label for="password">Rewrite the password</label>
                                                  <input type="password" class="form-control" id="re_password" placeholder="">
                                              </div>
                                              <div class="button-group d-flex mb-sm-35 mb-20">
                                                  <button class="btn btn-primary btn-default btn-squared mr-15 text-capitalize lh-normal px-md-50 py-15 signIn-createBtn" onclick="resetPassword()">
                                                      Reset you password
                                                  </button>
                                              </div>
                                          </div>
                                      </div>
                                      </div><!-- End: .card-body -->
                                  </div><!-- End: .card -->
                              </div><!-- End: .edit-profile -->
                          </div><!-- End: .col-xl-5 -->
                      </div>
                  </div><!-- End: .signUp-admin-right  -->
              </div><!-- End: .col-xl-8  -->
          </div>
</div>
</main>

<main class="main-content d-none" id="expired" style="background:#fff !important">
    <div class="signUP-admin">
      <div class="container-fluid">
          <div class="row justify-content-center">
              <div class="col-xl-8 col-lg-7 col-md-7 col-sm-8">
                  <div class="signUp-admin-right signIn-admin-right  p-md-40 p-10">
                      <div class="row justify-content-center">
                          <div class="col-xl-7 col-lg-8 col-md-12">
                              <div class="edit-profile mt-md-25 mt-0">
                                  <div class="card border-0">
                                      <div class="card-header border-0 pt-0 pb-0">
                                          <div class="signUp-header-top mt-md-0 mt-30">
                                              <h6>This link is no longer available</h6>
                                          </div>
                                      </div>
                                      <div class="card-body pt-20 pb-0">
                                          <div class="edit-profile__body">
                                              <div class="mb-10 my_div_err justify-content-center align-items-center d-none"
                                                     id="email-err">
                                                    Invalid Email
                                              </div>
                                              <div class="mb-10 my_div_success justify-content-center align-items-center d-none"
                                                     id="email-success">
                                                    Your Email Has Been Sent Successfully
                                              </div>
                                              <div class="button-group d-flex mb-sm-35 mb-20 justify-content-center">
                                                  <button class="btn btn-primary btn-default btn-squared mr-15 text-capitalize lh-normal px-md-50 py-15 signIn-createBtn" onclick="goback()">
                                                      back
                                                  </button>
                                              </div>
                                          </div>
                                      </div>
                                      </div><!-- End: .card-body -->
                                  </div><!-- End: .card -->
                              </div><!-- End: .edit-profile -->
                          </div><!-- End: .col-xl-5 -->
                      </div>
                  </div><!-- End: .signUp-admin-right  -->
              </div><!-- End: .col-xl-8  -->
          </div>
      </div>
    </div><!-- End: .signUP-admin  -->
</main>

<script src="{% static 'assets/vendor_assets/js/jquery/jquery-3.5.1.min.js' %}"></script>
<script>

    let reset_id = '{{ reset_id }}';

    $(function() {
        list = JSON.parse(localStorage.getItem('expire_key_list'))
        let flag = 0
        list.forEach(ele =>{
            if(ele.id * 1 == reset_id * 1) {
                let cur_time = new Date()
                let saved_time = new Date(ele.time)
                distance = cur_time.getTime() - saved_time.getTime()
                if (distance < 1800 * 1000) {
                    flag = 1;
                }
            }
        })
        if (flag == 1) {
            $("#success").removeClass("d-none")
        } else {
            $("#expired").removeClass("d-none")
        }
    })

    function resetPassword() {
        if(!$("#password-err").hasClass("d-none")) {
            $("#password-err").addClass("d-none")
        }
        if(!$("#password-success").hasClass("d-none")) {
            $("#password-success").addClass("d-none")
        }
        let password = $("#password").val()
        let repassword = $("#re_password").val()
        if(password == '') {
            $("#password-err").removeClass("d-none")
            return;
        }
        if(repassword == '') {
            $("#password-err").removeClass("d-none")
            return;
        }
        if (password != repassword) {
            $("#password-err").removeClass("d-none")
            return;
        }
        let url = '/post_reset_password/'
        let form_data = new FormData()
        form_data.append('reset_id', reset_id)
        form_data.append('password', password)
        $.ajax({
            url: url,
            type: 'POST',
            dataType: 'json',
            async: false,
            contentType: false,
            processData: false,
            data: form_data,
            beforeSend: function () {
            },
            success: function (data) {
                if(data.status * 1 == 1) {
                    $("#password-success").removeClass("d-none")
                }
                setTimeout(() => {
                    location.href = '/'
                }, 1000)
            },
        })
    }

    function goback() {
        location = '/forgetPassword';
    }

</script>

</body>

</html>
